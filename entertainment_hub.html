<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css"
        integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
</head>
<style>
    #site-footer,
    #site-header {
        display: none;
    }

    *,
    *::after,
    *::before {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }


    button {
        outline: none;
        border: none;
        border-radius: var(--btn-border-radius);
        box-shadow: var(--ui-drop-shadow-2);
        transition: var(--trans-1);
    }

    button:focus {
        outline: 0;
    }


    span {
        display: inline-block;
    }

    a {
        color: var(--color-base-2);
        text-decoration: none;
        transition: .2s;

    }

    a:hover {
        color: var(--color-base-2);
        text-decoration: none;
    }



    body {
        direction: rtl;
        background-color: #fff;
        color: var(--color-base-2);
        /* font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important; */


    }

    .background_div {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        opacity: .1;
        z-index: -1;
        filter: saturate(0);
        background-image: url("./1.png");
        background-size: 100%;
        background-repeat: no-repeat;
        background-blend-mode: luminosity;

    }

    :root {
        --color-prime: #fff;
        --color-primary-1: #04244a;
        --color-primary-2: #0468d7;
        --color-red: #e63946;
        --color-green: #37a447;
        --color-turquoise: #37a49a;
        --color-blue: #3766a4;
        --color-disabled: #c1c1c1;

        --color-base-1: #f8f9fb;
        --color-base-2: #464849;
        --ui-drop-shadow-1: 0px 8px 24px rgba(0, 0, 0, .25);
        --ui-drop-shadow-2: 0px 3px 25px rgba(0, 0, 0, .25);

        --font-size-heading-1: 60px;
        --font-size-heading-2: 36px;
        --font-size-heading-3: 28px;

        --padding-text-1: 1em;
        --padding-text-2: 2em;
        --padding-container-1: 1em;
        --padding-container-2: 2em;

        --gutter: 2em;
        --app-gutter: 15em;
        --card-border-radius: 24px;
        --btn-border-radius: 8px;
        /* --ui-card-width: 484px; */
        --trans-1: .2s;

    }

    .header {
        width: 100vw;
        top: 0;
        position: fixed;
        box-shadow: var(--ui-drop-shadow-1);
        background-color: var(--color-base-1);
        z-index: 1;
        padding: var(--padding-text-1);

    }

    .app__title {
        color: var(--color-base-2);
        font-size: var(--font-size-heading-3);
        font-weight: bold;
    }



    .the__start,
    .the__end {
        display: none;
        font-size: 0.8rem;
        text-align: center;
    }

    .app__container {
        margin: var(--app-gutter) 0;
    }


    .button__container {
        text-align: center;
        color: var(--color-base-1);

        transition: .2s;
    }

    .add__new_btn:hover {
        color: var(--color-base-1);
    }

    .add__new_btn {
        gap: 5px;
        transition: var(--trans-1);
        background-color: var(--color-primary-1);
        color: var(--color-prime);

    }


    .all__devices {
        gap: var(--gutter);
        width: 100%;
        padding: var(--padding-container-2);
    }

    .device__row {
        width: 100%;
        padding: var(--padding-container-1);
        border-radius: 8px;
    }

    .device__card {
        background-color: var(--color-base-1);
        border-radius: var(--card-border-radius);
        box-shadow: var(--ui-drop-shadow-1);
        cursor: pointer;
        overflow: hidden;
        padding: var(--gutter);
        position: relative;
        width: 25%;
    }

    .tracked__time {
        /* background-color: var(--color-base-1); */
        user-select: all;
    }

    .bttn {
        margin: auto;
        padding: var(--padding-text-1) var(--padding-text-2);
        text-align: center;
        box-shadow: var(--ui-drop-shadow-2);
        border-radius: var(--btn-border-radius);
    }

    .floating:hover {
        transform: translateY(-5%);
    }

    .stop {
        background-color: var(--color-red);
        color: var(--color-base-1);
    }

    .start {
        background-color: var(--color-base-1);
        color: var(--color-base-2);
    }

    .invoic {
        background-color: var(--color-base-1);
        color: var(--color-base-2);
    }

    .device__avatar {
        right: 0;
        bottom: -10%;
        position: absolute;

    }

    .playing::after {
        content: "";
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background-color: var(--color-red);
        top: 10%;
        left: 5%;
        position: absolute;
        animation: blinker 1s ease-in-out infinite;
    }

    .fa-playstation {
        font-size: 10rem;
        opacity: .05;
    }

    .invoice__btn {
        color: var(--color-base-2);
        transition: .2s;
    }

    .invoice__btn>button>a:hover {
        opacity: .7;
    }



    .create__invoice_btn::after {
        /* content: "";
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background-color: var(--color-green);
        top: 10%;
        left: 5%;
        position: absolute;
        animation: blinker 1s ease-in-out infinite; */
    }



    .disabled {
        /* background-color: var(--color-disabled); */
        pointer-events: none;
        border-radius: var(--btn-border-radius);
        color: var(--color-base-2);
    }

    @keyframes blinker {

        0%,
        100% {
            opacity: 0;
        }

        50% {
            opacity: 1;
        }
    }
</style>

<body>
    <div class="background_div"></div>
    <header class="header d-flex align-items-center justify-content-around">
        <div class="title__container">
            <p class="app__title">مركز MZ الترفهي</p>
        </div>
        <div class="add__new_container">
            <div class="button__container floating">

                <a href="/v2/owner/entity/workflow/le_workflow-type-entity-1/list"
                    class="add__new_btn bttn d-flex justify-content-around " target="_blank">
                    <div class="btn__icon">
                        <i class="fa-solid fa-plus"></i>
                    </div>
                    <div class="btn__title ">
                        جهاز جديد
                    </div>
                </a>
            </div>
        </div>
    </header>

    <main class="app__container d-flex flex-column ">


        <div class="all__devices d-flex flex-column flex-wrap">

            <div class="device__row d-flex justify-content-around align-items-center" data-device_id="sd">
                <div class=" device__card d-flex flex-column align-items-center">
                    <p class="device__name h3 text-center">جهاز رقم #1<br><span class="h6 mt-1">(بلاى ستيشن)</span></p>
                    <div class="device__avatar text-center">
                        <i class="fa-brands fa-playstation"></i>
                    </div>
                </div>
                <div class="action__btn d-flex justify-content-around col-3">
                    <button class="start__btn bttn start floating" type="button" data-serial="1">ابدأ الآن</button>
                    <button class="stop__btn bttn stop floating" type="button">إنهاء</button>
                </div>

                <div class="time__tracker">
                    <p class="the__start m-0">00:00:00</p>
                    <p class="timer m-0">00:00:00</p>
                    <p class="the__end m-0">00:00:00</p>
                </div>
                <div class="invoice__btn disabled floating">
                    <button class="create__invoice_btn bttn invoice" disabled>
                        <a href="/owner/invoices/add" target="_blank">
                            <span>إنشاء فاتورة</span>
                            <p class="tracked__time m-0 p-.4 rounded-1">00:00:00</p>
                        </a>
                    </button>

                </div>
            </div>
            <div class="device__row d-flex justify-content-around align-items-center" data-device_id="sd">
                <div class=" device__card d-flex flex-column align-items-center">
                    <p class="device__name h3 text-center">جهاز رقم #2<br><span class="h6 mt-1">(بلاى ستيشن)</span></p>
                    <div class="device__avatar text-center">
                        <i class="fa-brands fa-playstation"></i>
                    </div>
                </div>
                <div class="action__btn d-flex justify-content-around col-3">
                    <button class="start__btn bttn start floating" type="button" data-serial="1">ابدأ الآن</button>
                    <button class="stop__btn bttn stop floating" type="button">إنهاء</button>
                </div>

                <div class="time__tracker">
                    <p class="the__start m-0">00:00:00</p>
                    <p class="timer m-0">00:00:00</p>
                    <p class="the__end m-0">00:00:00</p>
                </div>
                <div class="invoice__btn disabled floating">
                    <button class="create__invoice_btn bttn invoice" disabled>
                        <a href="/owner/invoices/add" target="_blank">
                            <span>إنشاء فاتورة</span>
                            <p class="tracked__time m-0 p-.4 rounded-1">00:00:00</p>
                        </a>
                    </button>

                </div>
            </div>

            <div class="device__row"></div>
            <div class="device__row"></div>
            <div class="device__row"></div>
        </div>
    </main>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
        integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        $(document).ready(() => {



            function changeBtn(txt, color, bckColor, selector = $this) {
                $this.html(txt)
                $this.css({
                    color: color,
                    background: bckColor
                })
            }


            function timerrDisplay() {

                let secDisplay;
                let minDisplay;
                let hourDisplay;
                let timeDisplay;
                if (seconds < 59) {
                    seconds++;
                } else if (minutes < 59) {
                    seconds = 0;
                    minutes++;
                } else {
                    hours++;
                }
                secDisplay = seconds.toString().length > 1 ? `${seconds}` :
                    `0${seconds}`
                minDisplay = minutes.toString().length > 1 ? `${minutes}` :
                    `0${minutes}`
                hourDisplay = hours.toString().length > 1 ? `${hours}` :
                    `0${hours}`
                timeDisplay =
                    `${hourDisplay}:${minDisplay}:${secDisplay}`
                $this.parent().siblings(".time__tracker").find(".timer").html(timeDisplay)
                $this.siblings(".stop__btn").attr("data-duration", timeDisplay)
            }
            let hours = 0;
            let minutes = 0;
            let seconds = 0;
            var intervalIds = [];

            $(".start__btn").click(function () {
                $this = $(this)

                // let allIntervals = []
                let serialID = $this.data("serial")
                let serial = `newTimer${serialID}`

                // serial = new StartButton();
                console.log(serial)
                if ($this.html() == "ابدأ الآن") {
                    serial = setInterval(() => {
                        timerrDisplay()
                        console.log("0")
                    }, 1000)
                    intervalIds.push(serial);

                    $this.parent().siblings(".invoice__btn").attr("disabled", "disabled")

                    changeBtn("إيقاف", "var(--color-base-1)", "var(--color-turquoise)")
                    $this.parent().parent().find(".device__card").addClass("playing")
                    startTime = new Date().toLocaleTimeString().slice(0, -3)
                    $this.attr("data-start_time", startTime)

                } else if ($this.html() == "إيقاف") {

                    for (var i = 0; i < intervalIds.length; i++) {
                        clearInterval(intervalIds[i]);
                    }
                    let spentTime = $this.siblings(".stop__btn").data("duration")
                    changeBtn("استكمال", "var(--color-base-1)", "var(--color-green)")

                    intervalIds.push(serial);
                } else {
                    serial = setInterval(() => {
                        timerrDisplay()
                        console.log("0")
                    }, 1000)
                    intervalIds.push(serial);

                    changeBtn("إيقاف", "var(--color-base-1)", "var(--color-turquoise)")
                }
            })




            $(".stop__btn").click(function () {
                // clearInterval(theTimer)
                for (var i = 0; i < intervalIds.length; i++) {
                    clearInterval(intervalIds[i]);
                }
                $this = $(this)
                endTime = new Date().toLocaleTimeString().slice(0, -3)
                $this.attr("data-end_time", endTime)

                if ($this.html() == "إنهاء" && $this.siblings(".start__btn").html() == "ابدأ الآن") {
                    // console.log("GoTCHA!")


                } else if ($this.html() == "إنهاء") {
                    for (var i = 0; i < intervalIds.length; i++) {
                        clearInterval(intervalIds[i]);
                    }
                    $this.siblings(".start__btn").attr("disabled", "disabled").removeClass("floating")

                    dur = $this.data("duration")
                    dur = $this.parent().siblings(".time__tracker").find(".timer").text()
                    console.log(dur)
                    $this.parent().siblings(".invoice__btn").find("p").html(dur)
                    $this.parent().siblings(".invoice__btn").removeClass(
                        "disabled")
                    changeBtn("جديد", "var(--color-base-1)", "var(--color-blue)")

                    let theStart = $this.siblings(".start__btn").data("start_time")
                    $this.parent().siblings(".time__tracker").find(".the__start").html(theStart)
                        .fadeIn()
                    let theEnd = $this.data("end_time")
                    $this.parent().siblings(".time__tracker").find(".the__end").html(theEnd)
                        .fadeIn()

                } else {
                    changeBtn("إنهاء", "var(--color-base-1)", "var(--color-red)")

                    $this.siblings(".start__btn").removeAttr("disabled").addClass("floating")

                    $(".the__start, .the__end").html(`00:00:00`).fadeOut()
                    $this.parent().parent().find(".time__tracker .timer").html(`00:00:00`)
                    $this.parent().parent().find(".invoice .tracked__time ").html(`00:00:00`)

                    $this.parent().siblings(".invoice__btn").addClass(
                        "disabled")

                    $(".start__btn").attr("disabled")
                }

                // changeBtn("ابدأ الآن", "var(--color-base-2)", "var(--color-base-1)", $(".start__btn"))

                $this.siblings(".start__btn").html("ابدأ الآن")
                $(".start__btn").css({
                    background: "var(--color-base-1)",
                    color: "var(--color-base-2)",
                })
                $this.parent().parent().find(".device__card").removeClass("playing")


            })


            $(".create__invoice_btn").click(function () {
                $(".timer").html(`00:00:00`)
                window.location.open("/owner/invoices/add")

            })




            // ============== API CALL ===========




            $.get(`/v2/api/entity/le_workflow-type-entity-1/list`, data => {

                let allDvc = data.data.map(_ => {
                    let dvcName = _.title
                    let dvcDesc = _.description
                    console.log(dvcName, dvcDesc)

                    let dvc =
                        `
<div class="device__row d-flex justify-content-around align-items-center" data-device_id="sd">
                <div class=" device__card d-flex flex-column align-items-center">
                    <p class="device__name h3 text-center">${dvcName}<span class="h6 mt-1">(${dvcDesc})</span></p>
                    <div class="device__avatar text-center">
                        <i class="fa-brands fa-playstation"></i>
                    </div>
                </div>
                <div class="action__btn d-flex justify-content-around col-3">
                    <button class="start__btn bttn start floating" type="button">ابدأ الآن</button>
                    <button class="stop__btn bttn stop floating" type="button">إنهاء</button>
                </div>

                <div class="time__tracker">
                    <p class="the__start m-0">00:00:00</p>
                    <p class="timer m-0">00:00:00</p>
                    <p class="the__end m-0">00:00:00</p>
                </div>
                <div class="invoice__btn disabled floating">
                    <button class="create__invoice_btn bttn invoice" disabled>
                        <a href="/owner/invoices/add" target="_blank">
                            <span>إنشاء فاتورة</span>
                            <p class="tracked__time m-0 p-.4 rounded-1">00:00:00</p>
                        </a>
                    </button>

                </div>
            </div>
`

                    $(".all__devices").append(dvc)
                })

            })



        })
    </script>
</body>

</html>